#!/bin/bash
# Calculate if the backup has not been done for a certain timespan.
# This is meant to be used in other scripts or in a shell startup.

set -e

max_age_sec=$(echo "2 * 24 * 60 * 60" | bc) # 2 days
last_backup_file=~/.last-backup

if [[ ! -f "${last_backup_file}" ]]; then
  echo "Warning: Last backup file \"${last_backup_file}\" not found." >&2
  exit 1
fi

last_backup_time=$(cat "${last_backup_file}")
now=$(date +"%s")
diff=$(echo "$now - $last_backup_time" | bc)

if [[ $diff -ge $max_age_sec ]]; then
  echo "Your backup is outdated since ${diff} seconds" >&2
  echo "$diff"
  exit 0
else
  echo "All fine. You have $(echo "$max_age_sec - $diff" | bc) seconds until you need to do your next backup." >&2
  exit 1
fi
